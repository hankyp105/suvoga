<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Keyword Meaning Game</title>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevents scrolling */
        }
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        #canvas {
            background-color: #A2D4FF;
            width: 100%;
            height: 88vh; /* Adjusted to fit the canvas within viewport height */
            position: relative;
            overflow: hidden;
        }
        #line {
            border: 3px solid #FFA3D4;
            border-right-width: 0px;
            border-left-width: 0px;
            margin: 0;
            width: 100%;
        }
        #text {
            font-size: 23px;
            width: 300px;
            height: 30px;
            font-family: 'Century Gothic', sans-serif;
        }
        h5 {
            font-family: 'Century Gothic', sans-serif;
            font-size: 30px;
            margin:0px;
        }
        .controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        #point, #heart {
            font-family: 'Century Gothic', sans-serif;
            font-size: 17px;
        }
    </style>
</head>
<body>
    <div id="canvas"></div>
    <hr id="line">
    <div class="controls">
        <input id="text" placeholder="text" onkeypress="keydown(event.keyCode)">
        <button onclick="keydown(13)">Submit</button>
        <div>
            <b id="point"></b> / <b id="heart"></b>
        </div>
    </div>

    <script type="text/javascript">
        var canvasWidth = document.getElementById('canvas').offsetWidth;
        var canvasHeight = document.getElementById('canvas').offsetHeight;
        var words = {
            'a': 'a',
            'b': 'b',
            'c': 'c',
            'd': 'd',
            'e': 'e',
            'f': 'f',
            'g': 'g',
            'h': 'h',
            'i': 'i',
            'j': 'j',
            'k': 'k',
            'l': 'l',
            'm': 'm',
            'n': 'n'
        };
        var wordKeys = Object.keys(words); // Array of word keys
        var wordsOnScreen = {}; // Track active words on screen

        // Function to shuffle the wordKeys array
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        shuffle(wordKeys); // Shuffle the words to display in random order

        var word_cnt = 0;
        var point = 0; // Points
        var heart = 100000; // Lives
        var highestScore = 0; // Highest score

        // Initialize point and heart display
        document.getElementById('point').innerHTML = "Score: " + point;
        document.getElementById('heart').innerHTML = "Life: " + heart;

        // Function to handle game over scenario
        function gameover() {
            clearInterval(setInterval1);
            clearInterval(setInterval2);
            if (point > highestScore) {
                highestScore = point;
            }
            document.body.innerHTML = "<h1>Game Over</h1><h3>Highest Score: " + highestScore + "</h3><button onclick='location.reload()'><h3>Try Again</h3></button>";
        }

        // Function to safely remove an element by ID
        function remove_node(pRemoveEle) {
            if (pRemoveEle) {
                var vRemove = document.getElementById(pRemoveEle);
                if (vRemove) {
                    var vParent = vRemove.parentNode;
                    if (vParent) {
                        vParent.removeChild(vRemove);
                    }
                }
            }
        }

        // Function to generate a random speed
        function random_speed(maxSpeed) {
            return parseInt(Math.random() * maxSpeed) + 1;
        }

        // Function to generate a random width within canvas
        function random_width() {
            return parseInt(Math.random() * canvasWidth);
        }

        // Function to create and move word rain
        function wordRain() {
            this.y = 0;
            this.speed = random_speed(2);

            // Ensure no duplicate words on screen
            var availableWords = wordKeys.filter(word => !wordsOnScreen[word]);
            if (availableWords.length === 0) return; // No available words

            var word = availableWords[Math.floor(Math.random() * availableWords.length)];

            this.node = document.createElement('h5');
            this.node.id = word;
            this.node.innerHTML = word;
            wordsOnScreen[word] = true; // Add word to words on screen

            this.node.style.position = 'absolute';
            this.node.style.left = random_width() + 'px';

            document.getElementById('canvas').appendChild(this.node);

            // Move function for word rain
            wordRain.prototype.move = function () {
                if (this.y > canvasHeight - this.node.offsetHeight + 4) { // When it hits 10px above the bottom of the blue box
                    this.node.remove(); // Remove element
                    this.y = this.speed = 0;
                    delete wordsOnScreen[this.node.id]; // Remove from words on screen
                    heart -= 1;
                    document.getElementById('heart').innerHTML = "Life: " + heart;
                    if (heart < 1) gameover();
                    return;
                }
                this.y += this.speed;
                this.node.style.top = this.y + 'px';
            }
        }

        // Function to handle key down event for text input
        function keydown(keyCode) {
            if (keyCode == 13) {
                var text = document.getElementById('text'); // User input form
                
                if (Object.values(words).indexOf(text.value) !== -1) { // If input matches word meaning
                    var word = Object.keys(words).find(key => words[key] === text.value);
                    if (wordsOnScreen[word]) { // Check if the word is currently on the screen
                        remove_node(word);
                        for (var i in game) {
                            if (game[i]['node'].id == word) {
                                game[i]['y'] = 0;
                                game[i]['speed'] = 0;
                            }
                        }
                        delete wordsOnScreen[word]; // Remove from words on screen
                        point += 1;
                        document.getElementById('point').innerHTML = "Score: " + point;
                    }
                }
                text.value = "";
            }
            return;
        }
        
        var game = [];

        // Interval to create new word rain every second
        var setInterval1 = setInterval(function () {
            if (Object.keys(wordsOnScreen).length < 4) {
                game.push(new wordRain());
            }
        }, 1000); // Create a new word every second

        // Interval to move word rain
        var setInterval2 = setInterval(function () {
            for (var x in game) { game[x].move(); }
        }, 15); // Move words
    </script>
</body>
</html>